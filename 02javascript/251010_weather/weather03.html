<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.11.0/axios.min.js"
      integrity="sha512-h9644v03pHqrIHThkvXhB2PJ8zf5E9IyVnrSfZg8Yj8k4RsO4zldcQc4Bi9iVLUCCsqNY0b4WXVV4UB+wbWENA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.18/dayjs.min.js"
      integrity="sha512-FwNWaxyfy2XlEINoSnZh1JQ5TRRtGow0D6XcmAWmYCRgvqOUTnzCxPc9uF35u5ZEpirk1uhlPVA19tflhvnW1g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/ko.js"></script>
  </head>
  <body>
    <div>
      이곳에 좌표값은
      <button class="posBtn">좌표값</button><br />
      현재위치 - <span class="pos">0,0</span><br />

      <span class="location"></span>위치의 날씨 -
      <span class="weather"> 온도 : <span class="temp"></span> </span>
      <img
        src="https://openweathermap.org/img/wn/01d@2x.png"
        alt=""
        class="icon"
        width="100"
      />

      <ul class="forecast"></ul>
    </div>
    <script>
      //   navigator.geolocation.getCurrentPosition(function (position) {
      //     console.log(position.coords.latitude);
      //     console.log(position.coords.longitude);
      //   });

      const API_KEY = '';
      const posBtnElem = document.querySelector('.posBtn');
      const posElem = document.querySelector('.pos');
      const iconElem = document.querySelector('.icon');

      posBtnElem.addEventListener('click', function () {
        // alert('클릭');
        navigator.geolocation.getCurrentPosition(success);
      });

      function success(pos) {
        console.log('lat :' + pos.coords.latitude);
        console.log('lon :' + pos.coords.longitude);
        posElem.innerHTML =
          '위도 : ' + pos.coords.latitude + ', ' + pos.coords.longitude;
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        getWeather(lat, lon);
        getForecat(lat, lon);
      }

      async function getWeather(lat, lon) {
        try {
          const { data } = await axios.get(
            'https://api.openweathermap.org/data/2.5/weather',
            {
              params: {
                lat: lat,
                lon: lon,
                appid: API_KEY,
                units: 'metric',
                lang: 'kr',
              },
            }
          );

          document.querySelector('.temp').innerHTML = data.main.temp;
          document.querySelector('.location').innerHTML = data.name;
          let icon = data.weather[0].icon;
          let iconUrl = `images/${icon}.png`;
          iconElem.setAttribute('src', iconUrl);
        } catch (error) {}
      }

      async function getForecat(lat, lon) {
        try {
          const { data } = await axios.get(
            'https://api.openweathermap.org/data/2.5/forecast',
            {
              params: {
                lat: lat,
                lon: lon,
                appid: API_KEY,
                units: 'metric',
                lang: 'kr',
              },
            }
          );

          console.log(data.list);

          // data.list.forEach(function (item) {
          //   console.log(item.dt_txt, item.main.temp, item.weather[0].icon);
          // });

          const daily = {};
          data.list.forEach(function (item) {
            const date = item.dt_txt.substr(0, 10); // 2025-10-10

            if (!daily[date]) {
              // 없다면 true
              daily[date] = {
                temps: [],
                icons: [],
              };
            }
            daily[date].temps.push(item.main.temp);
            daily[date].icons.push(item.weather[0].icon);
          });
          // console.log(daily);
          // daily.forEach(function (item) {
          //   console.log(item);
          // });

          let viewForecast = '';

          dayjs.locale('ko'); // dayjs 한글 요일
          for (let date in daily) {
            // console.log(date);
            console.log(daily[date]);

            const temps = daily[date].temps;
            const min = Math.min(...temps);
            const max = Math.max(...temps);
            // const dayName = dayjs(date).format('YYYY년 MM월 DD일 dddd');
            const dayName = dayjs(date).format('dd');

            console.log(`${date} = 최저 : ${min} / 최대: ${max}`);

            // viewForecast += `<li>
            //   ${date} = 최저 : ${min} / 최대: ${max}
            //   <img src="images/${daily[date].icons[0]}.png" width='30'>

            //   </li>`;
            viewForecast += `<li>
              ${date} (${dayName}) = 최저 : ${min} / 최대: ${max}
              <img src="https://openweathermap.org/img/wn/${daily[date].icons[0]}@2x.png" width='30'>
              </li>`;
          }

          document.querySelector('.forecast').innerHTML = viewForecast;

          console.log('view=========' + daily['2025-10-10'].temps);
          //  daily =  {
          //    2025-10-10:{
          //      temps:[],
          //      icons:[]
          //    }
          //    2025-10-11:{
          //      temps:[],
          //      icons:[]
          //    }
          // }
        } catch (error) {}
      }

      getWeather(37.5665, 126.978);
      getForecat(37.5665, 126.978);
    </script>
  </body>
</html>
