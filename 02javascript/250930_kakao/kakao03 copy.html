<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="js/axios.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <style>
      ul,
      li {
        list-style: none;
        padding: 0;
      }
      .wrap {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    </style>
  </head>
  <body>
    <div class="container py-3">
      <h1 class="mb-3 text-center">카카오 검색</h1>

      <div class="row">
        <div class="offset-md-3 col-md-6">
          <form id="searchform" class="d-flex gap-2 mb-3">
            <input
              type="text"
              class="form-control search"
              placeholder="검색어를 입력하세요"
              value=""
            />
            <button type="submit" class="btn btn-primary" style="width: 100px">
              검색
            </button>
          </form>
          <div id="results" class="list-group">
            <ul>
              <li class="text-center py-5 bg-info rounded text-white">
                <!-- <h4>
                  <a href="#" class="nav-link wrap"
                    >Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                    Dolores, perferendis!</a
                  >
                </h4>
                <p>
                  Lorem ipsum dolor sit amet consectetur adipisicing elit.
                  Placeat aliquam culpa reiciendis amet architecto, iusto animi
                  facilis beatae, expedita nihil maxime. Molestias ratione
                  accusantium at! Commodi quia nulla cumque voluptas.
                </p>
                <p class="d-flex justify-content-end small">
                  <span>2025-09-15</span>
                </p> -->
                검색어를 입력하세요
              </li>
            </ul>
          </div>

          <nav class="d-flex justify-content-center align-items-center">
            <ul class="pagination">
              <!-- <li class="page-item">
                <a class="page-link active" href="#">1</a>
              </li>
              <li class="page-item"><a class="page-link" href="#">2</a></li>
              <li class="page-item"><a class="page-link" href="#">3</a></li>
              <li class="page-item"><a class="page-link" href="#">4</a></li>
              <li class="page-item"><a class="page-link" href="#">5</a></li> -->
            </ul>
          </nav>
        </div>
      </div>
    </div>
    <script>
      // document.getElementById("searchform").addEventListener("submit",function(){})

      let page = 1;
      let listCnt = 3;
      let pagerCnt = 5;
      // let totalRecord = 0; // kakao meta
      // let totalPage = 0;
      // let query = '';

      document
        .getElementById('searchform')
        .addEventListener('submit', function (e) {
          e.preventDefault();

          const query = document.querySelector('.search').value.trim();
          if (!query) {
            alert('검색어를 입력하세요');
          }
          page = 1;
          searchData(query, page);
        });

      async function searchData(query, page) {
        console.log(query, page);
        try {
          // const res = await axios.get('url',{ headers:{},params:{}})
          const { data } = await axios.get(
            'https://dapi.kakao.com/v2/search/blog',
            {
              headers: {
                Authorization: 'KakaoAK fa457cdf8aad5e817710e5043ba0ece7',
              },
              params: {
                query: query,
                page: page,
                size: listCnt,
              },
            }
          );

          console.log(data);

          // const data = res.data;

          let viewData = '';
          data.documents.forEach(function (item) {
            viewData += `
                            <li>
                              <h4>
                                <a href="${
                                  item.url
                                }" target="_blank" class="nav-link wrap"
                                  >${item.title}</a
                                >
                              </h4>
                              <div class="d-flex gap-3"><img src="${
                                item.thumbnail
                              }" class="rounded"><p>${item.contents}</p> </div>
                              <p class="d-flex justify-content-end small">
                                <span>${item.datetime.split('T')[0]}</span>
                              </p>
                            </li>
                            `;
          });
          // console.log(viewData);

          document.querySelector('#results>ul').innerHTML = viewData;
          let is_end = data.meta.is_end;
          console.log('마지막-' + is_end);

          pagination(query, page, is_end);
        } catch (error) {}
      }

      function pagination(query, page, isEnd) {
        const pageView = document.querySelector('.pagination');
        pageView.innerHTML = '';

        let startPage = Math.floor((page - 1) / pagerCnt) * pagerCnt + 1;
        let endPage = startPage + pagerCnt - 1;

        // if(endPage > totalPage){
        //   endPage = totalPage
        // }

        console.log(startPage, endPage);

        let pageNum = '';
        //previous button
        pageNum += `<li class="page-item ${
          page == 1 ? 'disabled' : ''
        }"><a class="page-link" href="#"
        onclick="searchData('${query}',${page - 1})">
          Previous</a></li>`;

        for (let i = startPage; i <= endPage; i++) {
          // if (i == page) {
          //   pageNum += "<li class='page-item active'>";
          // } else {
          //   pageNum += "<li class='page-item '>";
          // }

          pageNum += `<li class="page-item ${
            i == page ? 'active' : ''
          }"><a class="page-link" href="#" onclick="searchData('${query}',${i})">${i}</a></li>
          `;
        }
        //next button
        pageNum += `<li class="page-item ${isEnd == true ? 'disabled' : ''}">
          <a class="page-link" href="#" 
          onclick="searchData('${query}',${page + 1})">
          Next</a></li>`;

        pageView.innerHTML = pageNum;
      }

      // searchData('손흥민', 3);
    </script>
  </body>
</html>
